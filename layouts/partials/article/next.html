{{/*
    Prints the next 2 articles in the same section or, if less or 2 found, the first (and potentially second) of the section.

    @author @regisphilibert @mountainbug95

    @context Type Page (.)

    @access public

*/}}

{{/* declaring next empty slice */}}
{{ $next := slice }}
{{/* Checking if current article has a PrevInSection (Prev as we are ordering dsc here.) */}}
{{ with .PrevInSection }}
    {{ $next = $next | append . }}
    {{/* Checking for that "next" article own "next" to fill the "second next" */}}
    {{ with .PrevInSection }}
        {{ $next = $next | append . }}
    {{ end }}
{{ end }}
{{/* If the number of found "next article" is less than two we need to find the first and potentially second article
of the whole section and append them to our $next slice. */}}
{{ $diff := sub 2 (len $next) }}
{{ if $diff }}
    {{/* We use that diff number (if > 0) to grab the first x number of articles */}}
    {{ $articles := partialCached "func/GetArticles" . "articles"}}
    {{ $next = $next | append (first $diff $articles) }}
{{ end }}
<section id="articleNext" class="w-3/4 mx-auto">
    <h3 class="footer-next-heading"><span>More articles from {{ .Site.Title }}</span></h3>
    <div class="footer-spacer"></div>
    <div class="next-articles-grid" numberOfArticles={numberOfArticles}>
        <div class="grid md:grid-cols-5 gap-6">
            {{ range $index, $article := $next }}
                <a href="{{ $article.RelPermalink }}" class="article-link col-span-3 md:col-span-2"
                {{ if not $index}} id="bigger-link"{{ end }} title="{{ $article.Title }}">
                    <div class="">
                        <div class="overflow-hidden">
                           
                            {{- with $article.Params.hero -}}
            {{- $images := . -}}
            {{- with $article.Site.GetPage "section" "upload" -}}
                {{- with .Resources.GetMatch (strings.TrimPrefix "/upload/" (index $images 0)) -}}
                {{- $image1 := .Resize "621x q100" -}}
                {{- $image2 := .Resize "500x" -}}
                {{- $image3 := .Resize "291x" -}}
                <div class="article-hero-image h-56 relative " id="ArticleImage__Hero">
                        <img loading="lazy" class="{{ if not $index }} absolute w-full left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 {{ else }} absolute scale-150 left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2  {{ end }}" srcset="
                        {{ $image3.RelPermalink }} 375w,
                        {{ $image2.RelPermalink }} 700w,
                        {{ $image1.RelPermalink }} 1366w,  
                        " src="{{ $image1.RelPermalink }}" alt="{{ $article.Title }}">
                </div>
                {{- end -}}
            {{- end -}}
        {{- end -}}

                        </div>
                        <div>
                            <h2 class="article-title font-serif text-xl md:text-2xl font-bold">
                                {{ $article.Params.title }}
                            </h2>
                            <p class="article-excerpt">
                                {{ $article.Params.excerpt }}
                            </p>
                            <div class="article-metadata font-bold text-gray-300">
                                {{ $article.Date | dateFormat "January 2, 2006" }} Â· {{ $article.ReadingTime }} min read
                            </div>
                        </div>
                    </div>
                </a>
            {{ end }}
        </div>
    </div>
</section>
